<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Chat Home</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            /* display: flex; */
        }
        .small-box {
            width: 60px;
            height: 30px;
            background: #e0e0e0;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: #555;
        }
        .form-section {
            margin-bottom: 32px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
        }
        input[type="text"] {
            padding: 6px;
            width: 220px;
            margin-bottom: 10px;
        }
        button {
            padding: 6px 16px;
            background: #1976d2;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div class="form-section">
        <form>
            <input type="text" id="join-room" name="join-room" placeholder="Enter room code">
            <button type="submit">Join a room</button>
            or
            <input type="text" id="make-room" name="make-room" placeholder="Enter room name">
            <button type="submit">Make a room</button>
        </form>
    </div>

    <!-- simple script to send data to backend  -->
     <!-- if join a room, call get room with room id -->
      <!-- if make a room, call create room -->
    <script>
        let lastClicked = null;

        document.querySelectorAll('form button').forEach(btn => {
            btn.addEventListener('click', function(e) {
                lastClicked = this.textContent.trim();
            });
        });

        async function handleRoomAction(event) {
            event.preventDefault();

            if (lastClicked === "Join a room") {
                const roomId = document.getElementById('join-room').value.trim();
                if (roomId) {
                    // GET request to /room/:roomId
                    try {
                        const response = await fetch(`/rooms/${roomId}`);
                        if (response.ok) {
                            const data = await response.json();
                            // Redirect to the room
                            window.location.href = `/rooms/${data.room.id}`;
                        } else {
                            alert("Room not found.");
                        }
                    } catch (err) {
                        alert("Error joining room.");
                    }
                } else {
                    alert("Please enter a room name.");
                }
            } else if (lastClicked === "Make a room") {
                const name = document.getElementById('make-room').value.trim();
                // POST request to /createroom
                try {
                    const response = await fetch('/rooms', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: name })
                    });
                    if (response.ok) {
                        const data = await response.json();
                        // Redirect to the new room
                        window.location.href = `/rooms/${data.room.id}`;
                    } else {
                        alert("Failed to create room.");
                    }
                } catch (err) {
                    alert("Error creating room.");
                }
            }
        }

        document.querySelector('form').addEventListener('submit', handleRoomAction);

        
    </script>
</body>
</html>